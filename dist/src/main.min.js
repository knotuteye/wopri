const useDOM=()=>({homeWindow:document.getElementById("home"),gameWindow:document.getElementById("game-window"),gameOverWindow:document.getElementById("game-over"),questionHolder:document.getElementById("question-holder"),questionText:document.getElementById("question"),answerBoxes:document.getElementsByClassName("answer-holder"),finalScorePct:document.getElementById("final-score"),qNumberText:document.getElementById("qn-number").children[0]}),compose=(...e)=>t=>e.reduceRight((e,t)=>t(e),t),LOCAL_STORAGE_FACTORY=(e,t=(e=>e),n=(e=>e))=>({set:n=>window.localStorage.setItem(e,t(n)),get:()=>n(window.localStorage.getItem(e))}),ANSWER=LOCAL_STORAGE_FACTORY("answer"),QNUMBER=LOCAL_STORAGE_FACTORY("qnumber",e=>e.toString(),e=>parseInt(e)),QN_ARRAY=LOCAL_STORAGE_FACTORY("qn_array",e=>JSON.stringify(e),e=>JSON.parse(e)),startGame=()=>{ANSWER.set(""),QNUMBER.set(0),QN_ARRAY.set([]),compose(hideGameWindow,animateStartGame,fetchQuestion,initEventListeners)()},hideGameWindow=()=>{useDOM().gameWindow.hidden=!0},initEventListeners=()=>{useDOM().answerBoxes=[...useDOM().answerBoxes].map(e=>e.addEventListener("click",keepScore))},animateStartGame=()=>{useDOM().homeWindow.classList.add("flipOutY"),setTimeout(()=>{useDOM().homeWindow.hidden=!0},600)},generateQuestionSeed=()=>{const e=[17,18,19,30,23,20,27];return Array.from({length:15}).map(t=>e[Math.floor(Math.random()*e.length)])},fetchQuestion=async()=>{const e=generateQuestionSeed(),t={};e.forEach(e=>t[e]=(t[e]||0)+1);try{await Promise.all(Object.keys(t).map(async e=>{const n=`https://opentdb.com/api.php?amount=${t[e]}&difficulty=easy&type=multiple&category=${e}`,o=await fetch(n),s=await o.json();QN_ARRAY.set(QN_ARRAY.get().concat(s.results))})),renderNextQuestion(QN_ARRAY.get()[QNUMBER.get()])}catch(e){onDeviceOffline(e)}},renderNextQuestion=e=>{useDOM().questionText.innerText=decodeHTMLString(e.question),ANSWER.set(decodeHTMLString(e.correct_answer)),[e.correct_answer,...e.incorrect_answers].map(e=>decodeHTMLString(e)).sort(()=>.5-Math.random()).forEach((e,t)=>{useDOM().answerBoxes[t].querySelector("label").innerText=e}),QNUMBER.set(QNUMBER.get()+1),useDOM().qNumberText.innerText=QNUMBER.get(),useDOM().gameWindow.style.display="block",console.log(e.correct_answer)},keepScore=e=>{const t=e.target.querySelector(".answer-holder label")||e.target.closest(".answer-holder label")||e.target.nextSibling.nextSibling;t.innerText==ANSWER.get()?animateAll(t,!0):animateAll(t,!1)},animateAll=(e,t)=>{animateAnswerHolder(e.closest(".answer-holder"),t),animateQuestionHolder(t)},gameOver=e=>{if(e)return console.log("lol");useDOM().finalScorePct.innerText=`${(100*(QNUMBER.get()-1)/15).toFixed(0)}%`,useDOM().gameWindow.classList.replace("flipInY","slideOutUp"),setTimeout(()=>{useDOM().gameWindow.style.display="none"},600),useDOM().gameOverWindow.style.display="block"},animateQuestionHolder=e=>{e&&(useDOM().questionHolder.classList.add("fadeOut"),setTimeout(()=>{useDOM().questionHolder.classList.replace("fadeOut","fadeIn")},600),useDOM().questionHolder.classList.remove("fadeIn"))},animateAnswerHolder=(e,t)=>{e.classList.add(t?"correct":"wrong"),setTimeout(()=>{e.classList.remove(t?"correct":"wrong")},500),setTimeout(()=>{15==QNUMBER.get()&&gameOver(!0),t?renderNextQuestion(QN_ARRAY.get()[QNUMBER.get()]):gameOver()},600)},decodeHTMLString=e=>{const t=document.createElement("textarea");return t.innerHTML=e,t.innerText},onDeviceOffline=e=>{console.error(e)};